# Getting started
1. Before starting development server you need to define environment variables.
2. To be able to deploy project stack, your PATH should include executable aws package with configured IAM account.
3. Preferred package manager is `yarn` version 2.

## .ENV file
Environment variables file should include vars written below to be able to deploy AWS stack. Vars below is stale and should be define once for whole project.

```
COGNITO_CALLBACK_URL=http://localhost:3000/api/auth/callback/cognito
ADMIN_EMAIL
CDK_DEFAULT_ACCOUNT= default account that is being defined in aws configuration
CDK_DEFAULT_REGION= preferred region
AMAZON_ACCESS_KEY= IAM credentials
AMAZON_SECRET_KEY= IAM credentials
AMAZON_REGION= preferred region
```

After defining variables above you should run command `yarn stack:deploy`. That command will generate `cdk-outputs.json` that is being gitignored, that contain another variables that should be defined in the same .env file as above. 

### WARNING:
After running `yarn stack:deploy`, you always have to update your .env file, since stack is being regenerated.

```
{
  "reggae-media-stack": {
    "bucket",
    "settings",
    "userPoolClientId",
    "userPoolClientSecret",
    "articles",
    "userPoolId",
  }
}
```

Environments below should contain data that is being generated by aws-cdk-lib in `cdk-outputs.json`.

```
BUCKET_NAME="bucket"
TABLE_ARTICLES="articles"
COGNITO_CLIENT_SECRET="userPoolClientSecret"
COGNITO_CLIENT_ID="userPoolClientId"
COGNITO_USER_POOL_ID="userPoolId"
TABLE_SETTINGS="settings"
```

## Development process
After deploying your stack and defining all the variables run command `yarn dev` to start development process.

To be able to get full access to all protected and public paths you should create an user pool account, that MUST include Confirmation Status as Confirmed.

Temporary solution:

1. Create user account with [Cognito UI](console.aws.amazon.com/cognito/v2/home?region=us-east-1#)
2. After creating account using UI, your account will exist, but still you will have to confirm it with CLI command:

```
aws cognito-idp admin-set-user-password \
  --user-pool-id <your-user-pool-id> \
  --username <username> \
  --password <password> \
  --permanent
```

This command will confirm your account and you will be ready to coding.