# Getting started
1. Preferred package manager is `yarn` version 2.
2. Create the .env file in the root directory consists of following variables:

    - AMAZON_ACCESS_KEY —  IAM access key
    - AMAZON_SECRET_KEY — IAM secret key
    - AMAZON_REGION — default region
    - ADMIN_EMAIL — contact form submission destination email
    - COGNITO_CALLBACK_URL — callback for redirecting

    Following variables will be generated by cdk-lib

    - COGNITO_CLIENT_ID — cognito user id
    - COGNITO_CLIENT_SECRET — cognito secret key
    - COGNITO_USER_POOL_ID — cognito user pool id
    - BUCKET — static assets s3 name
    - TABLE_ARTICLES — dynamodb articles table
    - TABLE_SETTINGS — dynamodb settings table

All necessery infrastructure can be created and deployed using the yarn stack:deploy command. Only following parameters are required for this step: AMAZON_ACCESS_KEY, AMAZON_SECRET_KEY, AMAZON_REGION and COGNITO_CALLBACK_URL.

```
ADMIN_EMAIL
AMAZON_REGION
AMAZON_ACCESS_KEY
AMAZON_SECRET_KEY

BUCKET
TABLE_ARTICLES
TABLE_SETTINGS
COGNITO_CLIENT_ID
COGNITO_CLIENT_SECRET
COGNITO_USER_POOL_ID
COGNITO_CALLBACK_URL
```

### WARNING:
After running `yarn stack:deploy`, you always have to update your .env file, since stack is being regenerated.

```
{
  "reggae-media-stack": {
    "bucket",
    "settings",
    "userPoolClientId",
    "userPoolClientSecret",
    "articles",
    "userPoolId",
  }
}
```

## Development process
When the preparation is completed the yarn dev command will start the development server.

To be able to get full access to all protected and public paths you should create an user pool account, that **must** have Confirmation Status as Confirmed.

add user:

```
aws cognito-idp admin-create-user \ --user-pool-id <PoolId> \ --username <email>
```

add user name:

```
aws cognito-idp admin-update-user-attributes \ --user-pool-id <PoolId> \ --username <email> \ --user-attributes Name="name",Value="<Full Name>"
```

confirm user:

```
aws cognito-idp admin-set-user-password \ --user-pool-id <PoolId> \  -username <email> \ --password <password> \ --permanent
```

This command will confirm your account and you will be ready to code.

## Metadata
Scripts and their definition

- `dev` — start development process
- `build` — build project
- `start` — start production code
- `lint` — lint whole project for errors
- `stack:deploy` — deploy cloudformation stack
- `stack:destroy` — destroy cloud stack
- `postinstall` — install pre-commit hook
- `storybook` — start storybook development process
- `build-storybook` — build storybook static data